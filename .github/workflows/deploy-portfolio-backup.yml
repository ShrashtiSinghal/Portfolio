name: Deploy Portfolio (Backup - Manual Trigger)

on:
  workflow_dispatch:
    inputs:
      deployment_type:
        description: 'Deployment method'
        required: true
        default: 'npm'
        type: choice
        options:
        - npm
        - yarn

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-node@v4
      with:
        node-version: 18
        cache: ${{ github.event.inputs.deployment_type }}
        cache-dependency-path: |
          frontend/package-lock.json
          frontend/yarn.lock
          package-lock.json
          yarn.lock
    
    - name: Install and Build (NPM)
      if: github.event.inputs.deployment_type == 'npm'
      working-directory: ./frontend
      run: |
        npm ci --legacy-peer-deps
        npm run build
      env:
        CI: false
    
    - name: Install and Build (Yarn) 
      if: github.event.inputs.deployment_type == 'yarn'
      working-directory: ./frontend
      run: |
        yarn install --frozen-lockfile
        yarn build
      env:
        CI: false
    
    - uses: actions/configure-pages@v4
    
    - uses: actions/upload-pages-artifact@v3
      with:
        path: ./frontend/build
    
    - uses: actions/deploy-pages@v4